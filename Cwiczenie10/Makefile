#=============================================================================
# Kompilator i flagi
#=============================================================================
CC        := gcc
CFLAGS    := -Wall -Wextra -g -std=c99 -pedantic -pthread

PARENT_DIR = $(notdir $(CURDIR))

#=============================================================================
# Parametry programu
#=============================================================================
# Domyślna wartość, można nadpisać w wywołaniu: make run THREADS=5 SECTIONS=3
THREADS   ?= 5
SECTIONS  ?= 3

#=============================================================================
# Pliki źródłowe i obiekty
#=============================================================================
MAIN 	  := piekarnia
SRC       := $(MAIN).c
OBJ       := $(MAIN).o

#=============================================================================
# Plik wykonywalny
#=============================================================================
TARGET    := $(MAIN)

#=============================================================================
# Cele domyślne
#=============================================================================
.PHONY: all
all: $(TARGET)

#=============================================================================
# Reguła linkowania
#=============================================================================
$(TARGET): $(OBJ)
	$(CC) $(CFLAGS) -o $@ $(OBJ) $(LDFLAGS)

#=============================================================================
# Kompilacja obiektów
#=============================================================================
$(OBJ): $(SRC)
	$(CC) $(CFLAGS) -c $(SRC) -o $(OBJ)

#=============================================================================
# Uruchomienie programu
#=============================================================================
.PHONY: run
run: all
	@echo "Uruchamiam $(TARGET) z THREADS=$(THREADS), SECTIONS=$(SECTIONS)"
	./$(TARGET) $(THREADS) $(SECTIONS)

#=============================================================================
# Czyszczenie
#=============================================================================
.PHONY: clean
clean:
	rm -f $(OBJ) $(TARGET)

#=============================================================================
# Pakowanie do archiwum
#=============================================================================
.PHONY: tar
tar: clean
	(cd .. && tar cvzf $(PARENT_DIR).tar.gz $(PARENT_DIR) && ls -altr)

#=============================================================================
# Pomoc
#=============================================================================
.PHONY: help
help:
	@echo "----------------------------------------------------"
	@echo " Cele Makefile:"
	@echo "   make           - kompiluje program"
	@echo "   make run       - uruchamia program: THREADS i SECTIONS"
	@echo "   make clean     - usuwa obiekty i binarium"
	@echo "   make tar       - tworzy archiwum projektu"
	@echo "   make help      - ta pomoc"
	@echo "----------------------------------------------------"
